import{_ as J,r as b,o as K,a as Q,c as w,k as $,b as y,m as T,T as R,u as Z,d as C,g as _,h as tt,t as et}from"./index-BAVlgYOT.js";const at={class:"crime-and-punishment-world"},nt={key:0,class:"intro-text"},ot={key:0,class:"chapter-text"},st=["innerHTML"],it={key:0,class:"outro-text"},lt={__name:"CrimeAndPunishmentWorld",setup(ct){const A=Z(),u=b(null),S=b(0),W=b(!0),B=b(!1),I=b(!1),v=b("");let p=null,g=null,t=null,Y=0;const P=[{name:"第一章：房间",duration:15e3,hasContinueBtn:!1},{name:"第二章：理论",duration:2e4,hasContinueBtn:!0},{name:"第三章：斧头",duration:1e4,hasContinueBtn:!1},{name:"第四章：追逐",duration:15e3,hasContinueBtn:!0},{name:"第五章：崩溃",duration:2e4,hasContinueBtn:!1},{name:"第六章：相遇",duration:15e3,hasContinueBtn:!0},{name:"第七章：复活",duration:2e4,hasContinueBtn:!0}],x=b(!1),z=()=>{x.value?G():(S.value++,X())},X=()=>{p&&cancelAnimationFrame(p),g&&clearTimeout(g);const e=S.value,a=P[e];I.value=a.hasContinueBtn,x.value=e===P.length-1,Y=Date.now(),O(),!a.hasContinueBtn&&e<P.length-1&&(g=setTimeout(()=>{z()},a.duration))},O=()=>{if(!t||!u.value)return;const e=S.value,a=Date.now()-Y,o=Math.min(a/P[e].duration,1);switch(t.fillStyle="#000000",t.fillRect(0,0,u.value.width,u.value.height),e){case 0:D(o);break;case 1:L(o);break;case 2:E(o);break;case 3:H(o);break;case 4:F(o);break;case 5:N(o);break;case 6:V(o);break}o<1&&(p=requestAnimationFrame(O))},D=e=>{const{width:a,height:o}=u.value,f=a/2,m=o/2,n=Math.min(a,o)*.5,r=e*.6,s=n*(1-r),i=e*3,l=Math.sin(Date.now()/50)*i,c=Math.cos(Date.now()/50)*i;t.save(),t.translate(f+l,m+c);const d=e*.7;if(d>0&&(t.strokeStyle=`rgba(240, 230, 140, ${d*.5})`,t.lineWidth=5+d*10,t.strokeRect(-s/2,-s/2,s,s)),t.fillStyle="#1a1a1a",t.fillRect(-s/2,-s/2,s,s),t.strokeStyle=`rgba(255, 255, 255, ${.3-e*.2})`,t.lineWidth=2,t.strokeRect(-s/2,-s/2,s,s),t.restore(),e>.3){const h=Math.min((e-.3)/.2,1);v.value=`<span style="opacity: ${h}">三尺见方的房间<br>装得下整个世界的罪恶</span>`}},L=e=>{const{width:a,height:o}=u.value,f=a/2,m=o/2;t.fillStyle="#ffffff",t.fillRect(0,0,a,o);const n=Math.min(a,o)*.25,r=e*Math.PI*2;if(t.save(),t.translate(f,m),t.rotate(r),t.strokeStyle="#d4af37",t.lineWidth=3,t.strokeRect(-n/2,-n/2,n,n),e>.5){const s=(e-.5)/.5;t.strokeStyle=`rgba(139, 0, 0, ${s})`,t.lineWidth=2;for(let i=0;i<5;i++){const l=i/5*Math.PI*2,c=s*n*.4,d=Math.cos(l)*n/2,h=Math.sin(l)*n/2,k=Math.cos(l)*(n/2+c),M=Math.sin(l)*(n/2+c);t.beginPath(),t.moveTo(d,h),t.lineTo(k,M),t.stroke()}}if(e>.7){const s=(e-.7)/.3;t.fillStyle=`rgba(139, 0, 0, ${s*.3})`,t.fillRect(-n/2,-n/2,n,n)}if(t.restore(),e>.2){const s=Math.min((e-.2)/.3,1);v.value=`<span style="color: #1a1a1a; opacity: ${s}">有些人有权越过法律<br>我就是这样的人吗？</span>`}},E=e=>{const{width:a,height:o}=u.value,f=a/2,m=o/2;t.fillStyle="#000000",t.fillRect(0,0,a,o);const n=Math.min(a,o)*.4,r=3,s=Math.min(e*2,1),i=-n/2+s*n,l=e>.5,c=l?(e-.5)/.5:0;if(t.save(),t.translate(f,m),!l)t.strokeStyle="#d4af37",t.lineWidth=r,t.beginPath(),t.moveTo(0,i-n/2),t.lineTo(0,i+n/2),t.stroke();else{const d=c*50;if(t.strokeStyle="#d4af37",t.lineWidth=r,t.beginPath(),t.moveTo(0,i-n/2),t.lineTo(0,i-d),t.stroke(),t.beginPath(),t.moveTo(0,i+d),t.lineTo(0,i+n/2),t.stroke(),c>0){const h=c*Math.max(a,o),k=c*.8,M=t.createRadialGradient(0,i,0,0,i,h);if(M.addColorStop(0,`rgba(139, 0, 0, ${k})`),M.addColorStop(1,"rgba(139, 0, 0, 0)"),t.fillStyle=M,t.fillRect(-a/2,-o/2,a,o),c>.8){const j=(c-.8)/.2;t.fillStyle=`rgba(0, 0, 0, ${j})`,t.fillRect(-a/2,-o/2,a,o)}}}t.restore()},H=e=>{const{width:a,height:o}=u.value,f=a/2,m=o/2;t.fillStyle="#000000",t.fillRect(0,0,a,o);const n=Math.floor(e*30)+5,r=e*.4,s=a*(1-r),i=o*(1-r);t.save(),t.translate(f,m);for(let l=0;l<n;l++){const c=l/n*Math.PI*2+e,d=100+Math.random()*200,h=Math.cos(c)*d,k=Math.sin(c)*d,M=10+Math.random()*20;t.beginPath(),t.arc(h,k,M,0,Math.PI*2),t.fillStyle=`rgba(255, 255, 255, ${.1+Math.random()*.2})`,t.fill(),Math.random()>.3&&(t.beginPath(),t.arc(h,k,M*.3,0,Math.PI*2),t.fillStyle=`rgba(139, 0, 0, ${.3+Math.random()*.5})`,t.fill())}if(t.fillStyle=`rgba(0, 0, 0, ${e*.5})`,t.fillRect(-s/2,-i/2,s,i),t.restore(),e>.3&&e<.8){const l=["他知道","他们都知道","你无法隐藏","你无法宽恕"],c=Math.floor(e*10)%l.length,d=l[c];v.value=`<span style="opacity: ${.7}">${d}</span>`}},F=e=>{const{width:a,height:o}=u.value,f=["#1a0000","#000000","#2a2a2a","#3a0a0a"];for(let i=0;i<20;i++){t.fillStyle=f[i%f.length];const l=Math.random()*a,c=Math.random()*o,d=Math.random()*200+50,h=Math.random()*200+50;t.fillRect(l,c,d,h)}const m=10+Math.floor(e*20);for(let i=0;i<m;i++){t.save();const l=Math.random()*a,c=Math.random()*o,d=Math.random()*Math.PI*2,h=Math.random()*100+50;t.translate(l,c),t.rotate(d),t.fillStyle=`rgba(139, 0, 0, ${.1+Math.random()*.3})`,t.fillRect(-h/2,-h/2,h,h),t.strokeStyle=`rgba(255, 255, 255, ${.1+Math.random()*.2})`,t.lineWidth=1,t.strokeRect(-h/2,-h/2,h,h),t.restore()}const n=a/2,r=o/2,s=.5+Math.sin(Date.now()/100)*.5;if(t.beginPath(),t.arc(n,r,20,0,Math.PI*2),t.fillStyle=`rgba(255, 255, 255, ${s*.3})`,t.fill(),e>.4){const i=Math.min((e-.4)/.3,1);v.value=`<span style="opacity: ${i}">灵魂在尖叫<br>但没有人听见</span>`}},N=e=>{const{width:a,height:o}=u.value,f=a/2,m=o/2,n=1-e*.8;if(t.fillStyle=`rgba(26, 0, 0, ${n})`,t.fillRect(0,0,a,o),e>0){const r=Math.min(e*2,1),s=Math.sin(e*Math.PI)*20;t.beginPath(),t.strokeStyle=`rgba(255, 165, 0, ${r*.6})`,t.lineWidth=5;for(let i=0;i<360;i+=5){const l=i*Math.PI/180,c=50+Math.sin(l*3)*30+s,d=f+c*Math.cos(l),h=m+c*Math.sin(l)*.8;i===0?t.moveTo(d,h):t.lineTo(d,h)}t.closePath(),t.stroke(),e>.5&&(t.fillStyle=`rgba(255, 165, 0, ${r*.1})`,t.fill())}if(e>.3){const r=Math.min((e-.3)/.4,1);v.value=`<span style="opacity: ${r}; color: #ffa500;">接受苦难<br>通过苦难获得救赎</span>`}},V=e=>{const{width:a,height:o}=u.value,f=a/2,m=o/2;if(t.fillStyle=`rgba(230, 243, 255, ${e})`,t.fillRect(0,0,a,o),e>0){const n=o*.7;t.beginPath(),t.moveTo(0,n);for(let r=0;r<=a;r+=10){const s=n+Math.sin(r/100+e*Math.PI)*20;t.lineTo(r,s)}t.strokeStyle=`rgba(44, 62, 80, ${.3})`,t.lineWidth=2,t.stroke()}if(e>.3){const n=(e-.3)/.7,s=Math.min(a,o)*.15*n;if(t.beginPath(),t.arc(f,m,s,0,Math.PI*2),t.fillStyle=`rgba(255, 255, 255, ${n*.8})`,t.fill(),t.strokeStyle=`rgba(255, 255, 255, ${n})`,t.lineWidth=3,t.stroke(),n>.5){const i=Math.PI/6,l=Math.PI;t.save(),t.translate(f,m);const c=t.createRadialGradient(f+Math.cos(l+i/2)*s,m+Math.sin(l+i/2)*s,0,f+Math.cos(l+i/2)*s,m+Math.sin(l+i/2)*s,100);c.addColorStop(0,`rgba(255, 255, 200, ${n*.8})`),c.addColorStop(1,"rgba(255, 255, 200, 0)"),t.fillStyle=c,t.fill(),t.restore()}}if(e>.6){const n=Math.min((e-.6)/.3,1),r=`<span style="opacity: ${n}; font-size: 1.5em;">我复活了</span>`,s=`<span style="opacity: ${n*.7}; font-size: 1em; font-style: italic;">Воскресение</span>`;v.value=`${r}<br><br>${s}`}},G=()=>{B.value=!0,I.value=!1,setTimeout(()=>{A.push("/universe")},8e3)},q=()=>{W.value=!1,S.value=0,X()},U=()=>{u.value&&(t=u.value.getContext("2d"),u.value.width=window.innerWidth,u.value.height=window.innerHeight,setTimeout(()=>{q()},5e3))};return K(()=>{U(),window.addEventListener("resize",()=>{u.value&&(u.value.width=window.innerWidth,u.value.height=window.innerHeight)})}),Q(()=>{p&&cancelAnimationFrame(p),g&&clearTimeout(g)}),(e,a)=>(C(),w("div",at,[$(R,{name:"fade-in"},{default:T(()=>[W.value?(C(),w("div",nt,[...a[0]||(a[0]=[y("h1",{class:"intro-title"},"罪与罚",-1),y("p",{class:"intro-subtitle"},"这不是一个故事",-1),y("p",{class:"intro-subtitle"},"这是一场灵魂的审判",-1)])])):_("",!0)]),_:1}),y("canvas",{ref_key:"canvas",ref:u,class:"main-canvas"},null,512),$(R,{name:"text-fade"},{default:T(()=>[v.value?(C(),w("div",ot,[y("p",{class:"text-content",innerHTML:v.value},null,8,st)])):_("",!0)]),_:1}),$(R,{name:"btn-fade"},{default:T(()=>[I.value?(C(),w("button",{key:0,onClick:z,class:tt(["continue-btn",{"is-end":x.value}])},et(x.value?"结束":"继续"),3)):_("",!0)]),_:1}),$(R,{name:"fade-in"},{default:T(()=>[B.value?(C(),w("div",it,[...a[1]||(a[1]=[y("p",{class:"outro-line"},"罪与罚，不在外面",-1),y("p",{class:"outro-line"},"而在里面",-1),y("p",{class:"outro-author"},"陀思妥耶夫斯基",-1),y("p",{class:"outro-year"},"1866",-1)])])):_("",!0)]),_:1})]))}},ht=J(lt,[["__scopeId","data-v-ca096d6b"]]);export{ht as default};
