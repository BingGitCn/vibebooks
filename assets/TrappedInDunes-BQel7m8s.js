import{_ as W,r as l,o as B,f as _,a as R,c as k,j as A,b as t,l as V,T as N,h,u as S,d as z,g as X}from"./index-odFV5K-y.js";const Y={key:0,class:"warp-overlay"},q={class:"chapter-content"},D={__name:"TrappedInDunes",setup(F){const H=S(),f=l(null),i=l(null),m=l(null),C=l(!1),w=l(!0),n=l({chapter1:!1,chapter2:!1,chapter3:!1,chapter4:!1,chapter5:!1});let u=null,p=null,g=null,b=[],y=0,x=0;class O{constructor(e,r){this.canvasWidth=e,this.canvasHeight=r,this.reset()}reset(){this.x=Math.random()*this.canvasWidth,this.y=Math.random()*this.canvasHeight,this.size=Math.random()*2+1,this.speedX=Math.random()*.5-.25,this.speedY=Math.random()*.5+.2,this.opacity=Math.random()*.5+.2,this.color=`rgba(201, 169, 89, ${this.opacity})`}update(e,r){this.x+=this.speedX+e*.5,this.y+=this.speedY+r*.3,this.x>this.canvasWidth&&(this.x=0),this.x<0&&(this.x=this.canvasWidth),this.y>this.canvasHeight&&(this.y=0),this.y<0&&(this.y=this.canvasHeight)}draw(e){e.beginPath(),e.arc(this.x,this.y,this.size,0,Math.PI*2),e.fillStyle=this.color,e.fill()}}const T=()=>{var r;const s={root:f.value,threshold:.3};u=new IntersectionObserver(d=>{d.forEach(v=>{const o=v.target.dataset.chapter;o&&v.isIntersecting&&(n.value[`chapter${o}`]=!0,o==="1"&&E())})},s);const e=(r=f.value)==null?void 0:r.querySelectorAll(".story-chapter");e==null||e.forEach(d=>u.observe(d))},E=()=>{if(!i.value||!m.value)return;const s=i.value,e=m.value;g=s.getContext("2d");const r=()=>{const a=e.getBoundingClientRect();s.width=a.width,s.height=a.height};r();const d=200;for(let a=0;a<d;a++)b.push(new O(s.width,s.height));const v=a=>{const c=s.getBoundingClientRect();y=(a.clientX-c.left-c.width/2)/(c.width/2),x=(a.clientY-c.top-c.height/2)/(c.height/2)};s.addEventListener("mousemove",v);const o=()=>{g.clearRect(0,0,s.width,s.height),b.forEach(a=>{a.update(y,x),a.draw(g)}),p=requestAnimationFrame(o)};p=requestAnimationFrame(o);const M=new ResizeObserver(()=>{r(),b.forEach(a=>{a.canvasWidth=s.width,a.canvasHeight=s.height})});M.observe(e),s._resizeObserver=M,s._mouseMoveHandler=v},I=async()=>{C.value=!0,await _(),setTimeout(()=>{H.push("/universe")},800)};return B(async()=>{setTimeout(()=>{w.value=!1},1800),await _(),T(),setTimeout(()=>{n.value.chapter1=!0},2e3)}),R(()=>{u&&u.disconnect(),p&&cancelAnimationFrame(p),i.value&&(i.value._resizeObserver&&i.value._resizeObserver.disconnect(),i.value._mouseMoveHandler&&i.value.removeEventListener("mousemove",i.value._mouseMoveHandler))}),(s,e)=>(z(),k("div",{class:h(["trapped-in-dunes",{"is-transitioning":C.value}])},[A(N,{name:"warp"},{default:V(()=>[w.value?(z(),k("div",Y,[...e[0]||(e[0]=[t("div",{class:"warp-circle"},[t("div",{class:"warp-circle-inner"})],-1),t("div",{class:"warp-text"},"VOL.002",-1)])])):X("",!0)]),_:1}),t("button",{class:"exit-btn",onClick:I},[...e[1]||(e[1]=[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),t("span",null,"Return to Universe",-1)])]),t("div",{class:"scroll-container",ref_key:"scrollContainer",ref:f},[t("section",{class:h(["story-chapter chapter-1",{"is-visible":n.value.chapter1}]),"data-chapter":"1"},[t("div",q,[t("div",{class:"dunes-canvas-container",ref_key:"dunesCanvasContainer",ref:m},[t("canvas",{ref_key:"dunesCanvas",ref:i},null,512)],512),e[2]||(e[2]=t("div",{class:"opening-narrative"},[t("p",{class:"narrative-text"},"1930年，西北科学考察团在沙丘发现了第一批竹简。"),t("p",{class:"narrative-text-sub"},"风，吹了三千年，掩埋了一个王朝的背影。")],-1))])],2),t("section",{class:h(["story-chapter chapter-2",{"is-visible":n.value.chapter2}]),"data-chapter":"2"},[...e[3]||(e[3]=[t("div",{class:"chapter-content"},[t("p",{class:"placeholder-text"},"Chapter 2: 残简 - 散落的竹简")],-1)])],2),t("section",{class:h(["story-chapter chapter-3",{"is-visible":n.value.chapter3}]),"data-chapter":"3"},[...e[4]||(e[4]=[t("div",{class:"chapter-content"},[t("p",{class:"placeholder-text"},"Chapter 3: 双线 - 战国与民国")],-1)])],2),t("section",{class:h(["story-chapter chapter-4",{"is-visible":n.value.chapter4}]),"data-chapter":"4"},[...e[5]||(e[5]=[t("div",{class:"chapter-content"},[t("p",{class:"placeholder-text"},"Chapter 4: 困兽 - 沙丘宫的悲剧")],-1)])],2),t("section",{class:h(["story-chapter chapter-5",{"is-visible":n.value.chapter5}]),"data-chapter":"5"},[...e[6]||(e[6]=[t("div",{class:"chapter-content"},[t("p",{class:"placeholder-text"},"Chapter 5: 回响 - 历史的沉思")],-1)])],2)],512)],2))}},P=W(D,[["__scopeId","data-v-fb2b36c4"]]);export{P as default};
