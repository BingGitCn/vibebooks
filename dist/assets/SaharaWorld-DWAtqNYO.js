import{_ as te,r as f,o as ae,f as le,c as M,a as g,h as T,w as z,T as $,e as x,g as I,m as G,t as ie}from"./index-DDR65JC5.js";const ne={key:0,class:"chapter-text"},oe=["innerHTML"],se={key:0,class:"skip-hint"},_=500,he={__name:"SaharaWorld",setup(ce){const t=f(null);let e=null,R=null;const b=f(!0),C=f(!1),y=f(!1),O=f(!1),m=f(!1),w=f(0),S=f(""),L=f(!1),p=[{name:"起风",duration:15e3,text:"风，从远方吹来",hasButton:!1},{name:"流动",duration:18e3,text:"沙粒开始流动<br>形成大地的形状",hasButton:!1},{name:"安家",duration:15e3,text:"在这片荒凉中<br>我们建起了家",hasButton:!0},{name:"生活",duration:2e4,text:"生命的过程<br>无论是阳春白雪，还是青菜豆腐",hasButton:!1},{name:"远行",duration:18e3,text:"为何流浪<br>远方有我的梦",hasButton:!0},{name:"橄榄树",duration:15e3,text:"不要问我从哪里来<br>不要问我到哪里去",hasButton:!1},{name:"归宿",duration:2e4,text:"",hasButton:!0}],q=f({x:0,y:0});let P=[],k=0,d=0;const N=()=>{P=[];for(let i=0;i<_;i++)P.push({x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,size:Math.random()*2+1,speedX:(Math.random()-.5)*.5,speedY:Math.random()*.5+.2,opacity:Math.random()*.5+.3})},B=()=>{t.value&&(t.value.width=window.innerWidth,t.value.height=window.innerHeight)},F=i=>{const n=e.createLinearGradient(0,0,0,t.value.height);n.addColorStop(0,"#f5e6d3"),n.addColorStop(1,"#d4a574"),e.fillStyle=n,e.fillRect(0,0,t.value.width,t.value.height);const o=i*.8,s=Math.floor(_*o);for(let l=0;l<s;l++){const a=P[l],h=i*t.value.height*.7,c=(a.y-h)%t.value.height;e.beginPath(),e.arc(a.x,c,a.size,0,Math.PI*2),e.fillStyle=`rgba(139, 90, 43, ${a.opacity})`,e.fill()}if(i>.3){const l=(i-.3)/.7*.15;e.strokeStyle=`rgba(139, 90, 43, ${l})`,e.lineWidth=1;for(let a=0;a<20;a++){const h=a/20*t.value.height;e.beginPath(),e.moveTo(0,h),e.lineTo(t.value.width,h+Math.sin(d/1e3+a)*20),e.stroke()}}},X=i=>{const n=e.createLinearGradient(0,0,0,t.value.height);n.addColorStop(0,"#f5e6d3"),n.addColorStop(1,"#c9a067"),e.fillStyle=n,e.fillRect(0,0,t.value.width,t.value.height);const o=Math.min(i*1.5,1),s=d/2e3;for(let a=0;a<3;a++){const h=a*100,c=.3-a*.08,r=t.value.height*.6+a*80;e.beginPath(),e.moveTo(0,t.value.height);for(let u=0;u<=t.value.width;u+=10){const v=Math.sin((u+h)/300+s)*50,Y=r+v*o;e.lineTo(u,Y)}e.lineTo(t.value.width,t.value.height),e.closePath(),e.fillStyle=`rgba(180, 130, 70, ${c})`,e.fill()}const l=i*.6;for(let a=0;a<_;a++){const h=P[a],c=(h.x+d/50)%(t.value.width+100)-50,r=h.y+Math.sin(d/1e3+a)*20;e.beginPath(),e.arc(c,r,h.size,0,Math.PI*2),e.fillStyle=`rgba(139, 90, 43, ${h.opacity*l})`,e.fill()}},A=i=>{if(e.fillStyle="#d4a574",e.fillRect(0,0,t.value.width,t.value.height),e.fillStyle="#c9965f",e.fillRect(0,t.value.height*.6,t.value.width,t.value.height*.4),i>.2){const o=Math.min((i-.2)/.3,1),s=t.value.height*.3-i*50,l=e.createRadialGradient(t.value.width*.7,s,0,t.value.width*.7,s,80);l.addColorStop(0,`rgba(255, 200, 100, ${o})`),l.addColorStop(1,"rgba(255, 200, 100, 0)"),e.fillStyle=l,e.beginPath(),e.arc(t.value.width*.7,s,80,0,Math.PI*2),e.fill()}const n=Math.min(i*2,1);if(n>0){const o=t.value.width*.4,s=t.value.height*.55,l=100;e.fillStyle=`rgba(255, 250, 240, ${n})`,e.fillRect(o-l/2,s-l/2,l,l),e.beginPath(),e.moveTo(o-l/2-20,s-l/2),e.lineTo(o,s-l/2-60),e.lineTo(o+l/2+20,s-l/2),e.closePath(),e.fillStyle=`rgba(200, 150, 100, ${n})`,e.fill(),e.fillStyle=`rgba(255, 165, 0, ${n*.8})`,e.fillRect(o-20,s-10,40,40)}for(let o=0;o<100;o++){const s=P[o];e.beginPath(),e.arc(s.x,s.y+t.value.height*.6,s.size*.8,0,Math.PI*2),e.fillStyle=`rgba(139, 90, 43, ${s.opacity*.3})`,e.fill()}},V=i=>{const n=e.createRadialGradient(t.value.width/2,t.value.height/2,0,t.value.width/2,t.value.height/2,t.value.width/2),o=i*.5;n.addColorStop(0,`rgba(255, 200, 150, ${o})`),n.addColorStop(1,"#d4a574"),e.fillStyle=n,e.fillRect(0,0,t.value.width,t.value.height);const s=5;for(let a=0;a<s;a++){const h=Math.min((i-a*.15)*2,1);if(h>0){const c=t.value.width*(.3+a*.15),r=t.value.height*(.4+Math.sin(a)*.2),u=100+Math.sin(d/1500+a)*30,v=e.createRadialGradient(c,r,0,c,r,u);v.addColorStop(0,`rgba(255, 165, 0, ${h*.4})`),v.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=v,e.beginPath(),e.arc(c,r,u,0,Math.PI*2),e.fill()}}[{type:"circle",x:.25,y:.35,size:30},{type:"rect",x:.65,y:.45,size:40},{type:"triangle",x:.45,y:.6,size:35}].forEach((a,h)=>{const c=Math.min((i-h*.1)*3,1)*.6;if(c>0){e.fillStyle=`rgba(255, 250, 240, ${c})`;const r=a.x*t.value.width,u=a.y*t.value.height;a.type==="circle"?(e.beginPath(),e.arc(r,u,a.size,0,Math.PI*2),e.fill()):a.type==="rect"?e.fillRect(r-a.size/2,u-a.size/2,a.size,a.size):a.type==="triangle"&&(e.beginPath(),e.moveTo(r,u-a.size),e.lineTo(r+a.size,u+a.size),e.lineTo(r-a.size,u+a.size),e.closePath(),e.fill())}})},U=i=>{e.fillStyle="#d4a574",e.fillRect(0,0,t.value.width,t.value.height);const n=t.value.height*.55;e.fillStyle="#c9965f",e.fillRect(0,n,t.value.width,t.value.height-n);const o=8;for(let l=0;l<o;l++){const a=(i-l*.08)/.3;if(a>0&&a<=1){const h=t.value.width*(.15+l*.1),c=n+50+l*30,r=15+l*3,u=(1-a)*.6;e.beginPath(),e.ellipse(h-15,c,r*.6,r,0,0,Math.PI*2),e.fillStyle=`rgba(139, 90, 43, ${u})`,e.fill(),e.beginPath(),e.ellipse(h+15,c+40,r*.6,r,0,0,Math.PI*2),e.fill()}}const s=Math.min(i*1.5,1)*.3;e.fillStyle=`rgba(212, 165, 116, ${s})`;for(let l=0;l<20;l++){const a=(d/20+l*100)%(t.value.width+200)-100,h=n+Math.random()*200,c=100+Math.random()*100,r=2+Math.random()*3;e.fillRect(a,h,c,r)}e.strokeStyle=`rgba(255, 255, 255, ${i*.5})`,e.lineWidth=2,e.setLineDash([10,10]),e.beginPath(),e.moveTo(t.value.width*.9,n),e.lineTo(t.value.width*.95,n-100),e.stroke(),e.setLineDash([])},J=i=>{const n=e.createLinearGradient(0,0,0,t.value.height);n.addColorStop(0,"#1a3a5c"),n.addColorStop(1,"#2d4a6c"),e.fillStyle=n,e.fillRect(0,0,t.value.width,t.value.height);const o=50;for(let h=0;h<o;h++){const c=Math.random()*t.value.width,r=Math.random()*t.value.height*.6,u=Math.random()*2+1,v=Math.sin(d/500+h)*.3+.7;e.beginPath(),e.arc(c,r,u,0,Math.PI*2),e.fillStyle=`rgba(255, 255, 255, ${v*i})`,e.fill()}const s=i;e.strokeStyle=`rgba(255, 255, 255, ${s*.6})`,e.lineWidth=3,e.setLineDash([8,12]),e.beginPath(),e.moveTo(t.value.width/2-10,t.value.height*.9),e.lineTo(t.value.width/2,t.value.height*.6),e.lineTo(t.value.width/2+10,t.value.height*.9),e.stroke();const l=t.value.height*.5;e.beginPath(),e.ellipse(t.value.width/2-30,l,40,50,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.ellipse(t.value.width/2+30,l,45,55,0,0,Math.PI*2),e.stroke(),e.beginPath(),e.ellipse(t.value.width/2,l-40,35,40,0,0,Math.PI*2),e.stroke(),e.setLineDash([]);const a=15;for(let h=0;h<a;h++){const c=(i-h*.05)/.5;if(c>0&&c<=1){const r=t.value.width*(.3+h*.05)+Math.sin(d/1e3+h)*30,u=t.value.height*(.3+c*.6),v=8,Y=d/500+h;e.save(),e.translate(r,u),e.rotate(Y),e.beginPath(),e.ellipse(0,0,v,v/2,0,0,Math.PI*2),e.fillStyle=`rgba(100, 150, 100, ${c*.7})`,e.fill(),e.restore()}}},j=i=>{const n=Math.min(i*2,1);e.fillStyle=`rgba(245, 230, 211, ${n})`,e.fillRect(0,0,t.value.width,t.value.height);const o=i;for(let s=0;s<_;s++){const l=P[s],a=l.y*.8+t.value.height*.2,h=l.y+(a-l.y)*o,c=l.opacity*(1-o*.5);e.beginPath(),e.arc(l.x,h,l.size,0,Math.PI*2),e.fillStyle=`rgba(180, 140, 90, ${c})`,e.fill()}if(i>.5){const s=(i-.5)/.5*.4;e.fillStyle=`rgba(212, 165, 116, ${s})`;const l=60;e.fillRect(t.value.width*.4-l/2,t.value.height*.45-l/2,l,l),e.beginPath(),e.arc(t.value.width*.65,t.value.height*.45,40,0,Math.PI*2),e.fill()}if(i>.7){const s=(i-.7)/.3*.3;e.strokeStyle=`rgba(139, 90, 43, ${s})`,e.lineWidth=2,e.beginPath(),e.arc(t.value.width*.5,t.value.height*.7,20,0,Math.PI*2),e.stroke()}if(i>.9){const s=(i-.9)/.1*.2;e.fillStyle=`rgba(255, 255, 255, ${s})`,e.fillRect(0,0,t.value.width,t.value.height)}},W=()=>{if(!e)return;const i=Date.now();d=i;const n=i-k,o=Math.min(n/p[w.value].duration,1);switch(w.value){case 0:F(o);break;case 1:X(o);break;case 2:A(o);break;case 3:V(o);break;case 4:U(o);break;case 5:J(o);break;case 6:j(o);break}!b.value&&!C.value&&!m.value&&o>.3?O.value=!0:O.value=!1,o>=1&&(p[w.value].hasButton?m.value||(m.value=!0,L.value=w.value===p.length-1):D()),R=requestAnimationFrame(W)},D=()=>{m.value=!1,y.value=!1,w.value<p.length-1?(w.value++,k=Date.now(),S.value=p[w.value].text,setTimeout(()=>{y.value=!0},1e3)):setTimeout(()=>{C.value=!0,y.value=!1},1e3)},K=()=>{L.value?E():D()},Q=()=>{!b.value&&!C.value&&!m.value&&D()},Z=()=>{b.value=!1,S.value=p[0].text,k=Date.now(),setTimeout(()=>{y.value=!0},1e3)},E=()=>{b.value=!0,C.value=!1,m.value=!1,y.value=!1,w.value=0,S.value="",k=Date.now(),setTimeout(()=>{b.value=!1,S.value=p[0].text,setTimeout(()=>{y.value=!0},1e3)},3e3)},H=i=>{q.value={x:i.clientX,y:i.clientY}},ee=()=>{setTimeout(()=>{b.value=!1,S.value=p[0].text,k=Date.now(),setTimeout(()=>{y.value=!0},1e3)},3e3)};return ae(()=>{var i;e=(i=t.value)==null?void 0:i.getContext("2d"),B(),N(),window.addEventListener("resize",B),window.addEventListener("mousemove",H),ee(),W()}),le(()=>{window.removeEventListener("resize",B),window.removeEventListener("mousemove",H),R&&cancelAnimationFrame(R)}),(i,n)=>(x(),M("div",{class:"sahara-world",onClick:Q},[g("canvas",{ref_key:"canvas",ref:t},null,512),T($,{name:"fade"},{default:z(()=>[b.value?(x(),M("div",{key:0,class:"intro-text",onClick:G(Z,["stop"])},[...n[0]||(n[0]=[g("p",{class:"quote"},'"每想你一次，天上飘落一粒沙"',-1),g("p",{class:"quote-sub"},"从此形成了撒哈拉",-1),g("p",{class:"click-hint"},"点击进入 →",-1)])])):I("",!0)]),_:1}),T($,{name:"fade"},{default:z(()=>[y.value&&S.value?(x(),M("div",ne,[g("p",{innerHTML:S.value},null,8,oe)])):I("",!0)]),_:1}),T($,{name:"fade"},{default:z(()=>[O.value?(x(),M("div",se,[...n[1]||(n[1]=[g("p",null,"点击跳过 →",-1)])])):I("",!0)]),_:1}),T($,{name:"fade"},{default:z(()=>[m.value?(x(),M("button",{key:0,onClick:G(K,["stop"]),class:"continue-btn"},ie(L.value?"重新开始":"继续 →"),1)):I("",!0)]),_:1}),T($,{name:"fade"},{default:z(()=>[C.value?(x(),M("div",{key:0,class:"outro-text",onClick:G(E,["stop"])},[...n[2]||(n[2]=[g("p",{class:"quote"},'"不要问我从哪里来"',-1),g("p",{class:"quote-sub"},"我的故乡在远方",-1),g("p",{class:"author"},"— 三毛",-1),g("p",{class:"click-hint"},"点击重新开始 →",-1)])])):I("",!0)]),_:1})]))}},ue=te(he,[["__scopeId","data-v-d4b07ef0"]]);export{ue as default};
